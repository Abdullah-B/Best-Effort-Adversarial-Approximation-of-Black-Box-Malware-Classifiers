


import os

import csv

import numpy as np

import pandas as pd

import lief





with open("Tables/ApproachM.csv", 'w') as csvfile: #<- name of the file you want to save data name and lable in #############################################
    writer = csv.writer(csvfile, delimiter=',')
    writer.writerow(['FilesNames','y'])
    csvfile.close()



print("starting malware run")                
directory = os.fsencode("G:/DataCollection2/Malware") # <- this is the data directory ########################################
flag = True
nbr = 0
cntr = 0
for file in os.listdir(directory):
    filename = os.fsdecode(file)

    
    if(nbr<20000):

        try:
            binary = lief.parse("G:/DataCollection2/Malware/"+filename)# use this for string in this section
            

                               
            with open("G:/DataCollection2/Malware/"+filename,"rb") as f:
                
                header =f.read()
    
                 
              
            print("suc")

        
            with open('Tables/ApproachM.csv', 'a', newline='') as csvFile:
                writer = csv.writer(csvFile)
                
                

                row = ["G:/DataCollection2/Malware/"+filename ,'1'] # write directory + filename
                        
                                
                
                print(nbr)
                writer.writerow(row)
                
                csvFile.close()
            nbr=nbr+1
                    
        except:
            cntr=cntr+1
            print("fail")
            continue
    else:
        break


with open('Tables/ApproachM.csv') as csv_file: #<- change this accordingly 
    csv_reader = csv.reader(csv_file)   
    df = pd.DataFrame(csv_reader)
    df.to_csv('Tables/TrainingSet_BB.csv') #<- change thsi accordingly , there was a weird outcome where reading the file without this was crashing 
    csv_file.close()

#print(df)










with open("Tables/ApproachB.csv", 'w') as csvfile: #<- name of the file you want to save data name and lable in #############################################
    writer = csv.writer(csvfile, delimiter=',')
    writer.writerow(['FilesNames','y'])
    csvfile.close()

print("starting Benign run")             
directory = os.fsencode("I:/BenignData/DataCollection") # <- this is the data directory ########################################
flag = True
nbr = 0
cntr = 0
for file in os.listdir(directory):
    filename = os.fsdecode(file)# plus file name
    #print("new file")
    if(nbr<20000):

        try:               
            
            print("suc")
            #bytez = bytez_to_numpy( header, maxlen ) 
        
            with open('Tables/ApproachB.csv', 'a', newline='') as csvFile:
                writer = csv.writer(csvFile)
                filename = os.fsdecode(file)
                
                filename = filename.replace('.exe', '')
                row = ["I:/BenignData/DataCollection/"+filename ,'0'] # write directory + filename
                        #if you change the above for Benigns remember to change 1 to 0 ####################################################
                                
                
                print(nbr)
                writer.writerow(row)
                
                csvFile.close()
            nbr=nbr+1
                    
        except:
            cntr+=1
            print("fail")
            continue
    else:
        break


with open('Tables/ApproachB.csv') as csv_file: #<- change this accordingly 
    csv_reader = csv.reader(csv_file)   
    df = pd.DataFrame(csv_reader)
    df.to_csv('Tables/TrainingSet_BB.csv', mode='a', header=False) #<- change thsi accordingly , there was a weird outcome where reading the file without this was crashing 
    csv_file.close()


############################################################ Below is the code that will collect the rest of the benigns and Malwares#############################################################################################
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#

with open("Tables/AproxDataB.csv", 'w') as csvfile: #<- name of the file you want to save data name and lable in #############################################
    writer = csv.writer(csvfile, delimiter=',')
    writer.writerow(['FilesNames','y'])
    csvfile.close()

data = pd.read_csv('Tabels/ApproachB.csv', index_col=False) 
df = pd.DataFrame(data)

print("starting Benign run for approximator")                
directory = os.fsencode("I:/BenignData/DataCollection") # <- this is the data directory ########################################
flag = True
nbr = 0
cntr = 0
for file in os.listdir(directory):
    filename = os.fsdecode(file)# plus file name
    #print("new file")
    exists = df[df.isin(["I:/BenignData/DataCollection/"+filename])].dropna(how='all').count()
        
    if exists[0]  != 0 :
        
        try:
            binary = lief.parse("I:/BenignData/DataCollection/"+filename)# use this for string in this section
            #exists = df[df.isin(['G:/DataCollection2/Malware/'+filename])].dropna(how='all').count()
        
            # if  exists[0]  != 0 :
            #     print('*')
            #     continue
                                
            with open("I:/BenignData/DataCollection/"+filename,"rb") as f:
                header =f.read()
                 
            
            print("suc")
            #bytez = bytez_to_numpy( header, maxlen ) 
        
            with open('Tables/AproxDataB.csv', 'a', newline='') as csvFile:
                writer = csv.writer(csvFile)
                filename = os.fsdecode(file)
                
                filename = filename.replace('.exe', '')
                row = ["I:/BenignData/DataCollection/"+filename ,'0'] # write directory + filename
                        #if you change the above for Benigns remember to change 1 to 0 ####################################################
                                
                
                print(nbr)
                writer.writerow(row)
                
                csvFile.close()
            nbr=nbr+1
                    
        except:
            cntr=cntr+1
            print("fail")
            continue
    else:
        continue


with open('Tables/AproxDataB.csv') as csv_file: #<- change this accordingly 
    csv_reader = csv.reader(csv_file)   
    df = pd.DataFrame(csv_reader)
    df.to_csv('Tables/TrainingSet_Aprox.csv') #<- change thsi accordingly , there was a weird outcome where reading the file without this was crashing 
    csv_file.close()



with open("Tables/AproxDataM.csv", 'w') as csvfile: #<- name of the file you want to save data name and lable in #############################################
    writer = csv.writer(csvfile, delimiter=',')
    writer.writerow(['FilesNames','y'])
    csvfile.close()

print("starting Malware run for approximator")             
directory = os.fsencode("G:/DataCollection2/Malware") # <- this is the data directory ########################################
flag = True
nbr = 0
cntr = 0

data = pd.read_csv('Tabels/ApproachM.csv', index_col=False) not needed anymore
df = pd.DataFrame(data)
for file in os.listdir(directory):
    filename = os.fsdecode(file)# plus file name
    #print("new file")
    exists = df[df.isin(["G:/DataCollection2/Malware/"+filename])].dropna(how='all').count()
    
    if   exists[0]  != 0 and (nbr<8335): 

        try:
            binary = lief.parse("G:/DataCollection2/Malware/"+filename)# use this for string in this section
            #exists = df[df.isin(['G:/DataCollection2/Malware/'+filename])].dropna(how='all').count()
        
            # if  exists[0]  != 0 :
            #     print('*')
            #     continue
                                
            with open("G:/DataCollection2/Malware/"+filename,"rb") as f:
                header =f.read()
                 
            
            print("suc")
            #bytez = bytez_to_numpy( header, maxlen ) 
        
            with open('Tables/ApproachM.csv', 'a', newline='') as csvFile:
                writer = csv.writer(csvFile)
                filename = os.fsdecode(file)
                

                row = ["G:/DataCollection2/Malware/"+filename ,'0'] # write directory + filename
                        #if you change the above for Benigns remember to change 1 to 0 ####################################################
                                
                
                print(nbr)
                writer.writerow(row)
                
                csvFile.close()
            nbr=nbr+1
                    
        except:
            cntr+=1
            print("fail")
            continue
    else:
        continue


with open('Tables/ApproachM.csv') as csv_file: #<- change this accordingly 
    csv_reader = csv.reader(csv_file)   
    df = pd.DataFrame(csv_reader)
    df.to_csv('Tables/TrainingSet_Aprox.csv', mode='a', header=False, ) #<- change thsi accordingly , there was a weird outcome where reading the file without this was crashing 
    csv_file.close()
           

################################################################################################################



# data = pd.read_csv('F:/DataCollection2/TS2.csv', index_col=False)
# df = pd.DataFrame(data)

# print('got past malware')
# directory = os.fsencode("H:/DataCollection/")
# flag = True
# nbr = 0
# print('starting H collection')
# for file in os.listdir(directory):
#     filename = os.fsdecode(file)
#     #print("new file")
#     exists = df[df.isin(['H:/DataCollection/'+filename])].dropna(how='all').count()
    
#     if  exists[0]  != 0 :
#         print('*')
#         continue

#     with open('F:/DataCollection2/Approach.csv', 'a', newline='') as csvFile:
#         writer = csv.writer(csvFile)
        
#         if filename.endswith(".exe"):
#             #print("its exe")

#             row = ['H:/DataCollection/'+filename,'0']
#             #print(filename)
            
#             nbr=nbr+1
#             print(nbr)
#             writer.writerow(row)
                
#         csvFile.close()
 
# print('got past H')
# directory = os.fsencode("F:/DataCollection/")
# flag = True
# nbr = 0
# print('starting F collection')
# for file in os.listdir(directory):
#     #print("new file")
#     filename = os.fsdecode(file)
#     exists = df[df.isin(['F:/DataCollection/'+filename])].dropna(how='all').count()
#     if  exists[0]  != 0 :
#         print('*')
#         continue
        

        
#     with open('F:/DataCollection2/Approach.csv', 'a', newline='') as csvFile:
#         writer = csv.writer(csvFile)
        
#         if filename.endswith(".exe"):
#             #print("its exe")

#             row = ['F:/DataCollection/'+filename, '0']
#             #print(filename)
            
#             nbr=nbr+1
#             print(nbr)
#             writer.writerow(row)
                
#         csvFile.close()
    
        


















            
       